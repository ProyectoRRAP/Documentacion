\chapter{Laboratorio de pruebas}
\label{chapter6}

% **************************** Define Graphics Path **************************
\ifpdf
    \graphicspath{{Chapter6/Figs/Raster/}{Chapter6/Figs/PDF/}{Chapter6/Figs/}}
\else
    \graphicspath{{Chapter6/Figs/Vector/}{Chapter6/Figs/}}
\fi

Para validar funcionalmente el prototipo es preciso la construcción de un laboratorio de experimentación sobre el cual ejecutar un conjunto de pruebas e implementar algunos casos de uso representativos. Dentro de las pruebas funcionales se busca verificar aspectos importantes de la implementaci\'on como la clasificación de tr\'afico, el algoritmo de ruteo dinámico y el algoritmo de distribución de etiquetas.

Por otro lado con la implementaci\'on de algunos casos de uso representativos se busca validar la utilización del enfoque OpenFlow/SDN en la construcci\'on de la RAU2.\\

El siguiente capitulo esta destinado a la presentación del laboratorio de pruebas construido y a la descripción de las diferentes pruebas realizadas.

% **************************** Construccion del TestBed ************************** 
\section{Definición del Laboratorio}

Como se menciona anteriormente uno de los objetivos de este laboratorio de experimentaci\'on es verificar el correcto funcionamiento de la implementaci\'on realizada, en particular en los aspectos críticos de la misma como la capacidad para clasificar tr\'afico y los diferentes algoritmos de ruteo, distribución de etiquetas, actualización topol\'ogica, etc. 

Para esto es necesario construir un prototipo con suficientes nodos y enlaces como para poder definir varios servicios de redes privadas. Tambi\'en interesa la existencia de caminos alternativos entre un par de nodos origen y destino para poder comprobar el funcionamiento del algoritmo de ruteo y evaluar el comportamiento del prototipo cuando la topolog\'ia cambia, desconectando enlaces, apagando nodos, etc.\\

Teniendo en cuanta los requerimientos mencionados se construye un laboratorio de pruebas con la siguiente topolog\'ia (ver figura \ref{fig:LaboratorioDePruebasTopo}).
  
\begin{figure}[ht!] 
\centering    
\includegraphics[width=0.85\textwidth]{Topologia}
\caption[Laboratorio de pruebas - Topolog\'ia]{Laboratorio de pruebas - Topolog\'ia}
\label{fig:LaboratorioDePruebasTopo}
\end{figure}

El laboratorio se compone de cuatro nodos implementados en base al dispositivo RAU-Switch conectados entre si con enlaces de fibra \'optica multimodo. Cada nodo esta conectado a los otros tres nodos de la topolog\'ia implementando de esta forma una topolog\'ia full mesh de cuatro nodos. A su vez cada nodo esta conectado al controlador SDN del prototipo mediante una interfaz de red ethernet (interfaces \textbf{eth0}).\\

Por la forma que tiene la topolog\'ia, los cuatro nodos nombrados \textit{Galois}, \textit{Poisson}, \textit{Oz} y \textit{Alice} son nodos de borde. Esto quiere decir que RAUFlow los considera como nodos habilitados para ser nodo de ingreso \'o nodo de egreso en la definici\'on de servicios de redes privadas.

Por otro lado cada nodo cuenta con una interfaz de red de ethernet adicional (interfaz \textbf{eth1}) utilizada como interfaz externa para la conexi\'on con otras subredes. Estas interfaces son utilizadas por RAUFlow para la definici\'on de servicios de VPN como los puntos de entrada y salida de tr\'afico. Por tanto cada una de estas interfaces se encuentra directamente conectada a la subred de una VPN en particular.\\  

Como se menciona anteriormente en el cap\'itulo 5, la representaci\'on utilizada para modelar una topolog\'ia de red es la de un multigrafo dirigido ponderado. En la figura \ref{fig:LaboratorioDePruebasCostos} se muestra esta representaci\'on para la topolog\'ia del prototipo. Como puede apreciarse en la im\'agen cada enlace tiene un costo asociado. Este costo se define mediante el archivo de configuraci\'on del demonio Unix OSPF en cada nodo de la red y es utilizado por el algoritmo SPF centralizado para el calculo de las mejores rutas.

Por simplicidad en el diagrama se han obviado los enlaces existentes entre el Controlador y cada uno de los nodos. Como se menciona en el cap\'itulo 4 la instancia de Quagga ejecutada en el controlador tiene como \'unico objetivo contar con un acceso local a la LSDB. Por ello conceptualmente el costo asociado a cada uno de estos enlaces es infinito, lo cual en la pr\'actica se realiza asignando el valor 65535.  

\begin{figure}[ht!] 
\centering    
\includegraphics[width=0.85\textwidth]{TopologiaCostos}
\caption[Laboratorio de pruebas - Costos de enlaces en la topolog\'ia]{Laboratorio de pruebas - Costos de enlaces en la topolog\'ia}
\label{fig:LaboratorioDePruebasCostos}
\end{figure}

Sobre este laboratorio se implementan dos casos de uso representativos: (a) VPN de capa 3 y (b) VPN de capa 2. Sobre cada uno de estos casos de uso a su vez se ejecutan una serie de pruebas orientadas a verificar el correcto funcionamiento de las componentes m\'as importantes en la implementaci\'on de RAUFlow y RAU-Switch.

A continuaci\'on se describen los resultados obtenidos en la implementaci\'on de estos casos de uso y la ejecuci\'on de estas pruebas, comenzando por el caso de uso VPN de capa 3.

\section{VPN de capa 3}

Las redes privadas virtuales de capa 3 son un tipo de servicio comúnmente brindado por un operador de red y es uno de los servicios que se quiere implementar en la RAU2. Sobre este tipo de redes privadas puede implementarse clasificaci\'on de tr\'afico por tipo de aplicaci\'on o numeraci\'on de capa 3 por citar algunos ejemplos.\\

En este trabajo se implementan dos escenarios diferentes para este tipo de red privada: (a) red privada multipunto con una \'unica organizaci\'on y tres sucursales f\'isicamente separadas, (b) red privada punto a punto con dos organizaciones, cada una de ellas con dos sucursales f\'isicamente separadas.

A continuaci\'on se detalla la construcci\'on de ambos escenarios y los resultados obtenidos.

\subsection{Escenario 1}

Este escenario representa una red privada multipunto de capa 3. En el mismo se tiene una sola organizaci\'on o red privada dividida en 3 sucursales o subredes físicamente separadas.

\begin{figure}[ht!] 
\centering    
\includegraphics[width=1.0\textwidth]{CU1P1}
\caption[VPN de capa 3 - Escenario 1]{VPN de capa 3 - Escenario 1}
\label{fig:CUP1}
\end{figure}

Sobre este escenario se ejecutan una serie de pruebas orientadas a verificar los siguientes aspectos relacionados al prototipo:

\begin{enumerate}
\item Algoritmo de ruteo
\item Algoritmo de distribución de etiquetas
\item Clasificaci\'on de tr\'afico
\item Actualizaci\'on de rutas cuando cambia la topolog\'ia
\item Capacidad para crear VPN multipunto
\end{enumerate}

Para construir la red privada multipunto uniendo las tres subredes mencionadas y adem\'as verificar los puntos anteriores, se instancia los siguientes servicios (ver tabla \ref{table:TablaFlujos}). Por cada par de subredes se crean dos servicios (un servicio para cada sentido del tr\'afico).\\

\begin{table}[h]
\begin{tabular}{| l | l | l | p{4cm} | p{4cm} |}
\hline
Nombre & Ingreso & Egreso & Clasificación & Descripción \\ \hline

\crule[Aquamarine]{0.3cm}{0.3cm} S1 & Galois - eth1 & Oz - eth1 & ip\_src=20.20.20.128/26 ip\_dst=20.20.20.0/26 eth\_type=0x0800 & Tr\'afico IP de Subred A a Subred C \\ \hline

\crule[Red]{0.3cm}{0.3cm} S2 & Oz - eth1 & Galois - eth1 & ip\_src=20.20.20.0/26 ip\_dst=20.20.20.128/26 eth\_type=0x0800 & Tr\'afico IP de Subred C a Subred A \\ \hline

\crule[ForestGreen]{0.3cm}{0.3cm} S3 & Galois - eth1 & Poisson - eth1 & ip\_src=20.20.20.128/26 ip\_dst=20.20.20.64/26 eth\_type=0x0800 & Tr\'afico IP de Subred A a Subred B \\ \hline

\crule[LimeGreen]{0.3cm}{0.3cm} S4 & Poisson - eth1 & Galois - eth1 & ip\_src=20.20.20.64/26 ip\_dst=20.20.20.128/26 eth\_type=0x0800 & Tr\'afico IP de Subred B a Subred A \\ \hline

\crule[RoyalPurple]{0.3cm}{0.3cm} S5 & Poisson - eth1 & Oz - eth1 & ip\_src=20.20.20.64/26 ip\_dst=20.20.20.0/26 eth\_type=0x0800 IP & Tr\'afico de Subred B a Subred C \\ \hline

\crule[YellowOrange]{0.3cm}{0.3cm} S6 & Oz - eth1 & Poisson - eth1 & ip\_src=20.20.20.0/26 ip\_dst=20.20.20.64/26 eth\_type=0x0800 & Tr\'afico IP de Subred C a Subred B \\ \hline 

\end{tabular}
\vspace{0.3cm}
\caption[CU1 - Escenario 1, servicios creados]{CU1 - Escenario 1, servicios creados}
\label{table:TablaFlujos}
\end{table}

Para cada uno de estos servicios adem\'as se indica el etherype 0x0800 correspondiente al tipo de tr\'afico IPv4.\\

Este conjunto de servicios establece el procesamiento de paquetes de capa 3 para las diferentes subredes de forma de conectarlas en una red privada de capa 3. A continuaci\'on se detallan las pruebas realizadas para cada uno de los aspectos mencionados anteriormente.

%Sin embargo no alcanzan para la implementaci\'on de la misma. Es necesario definir un conjunto de servicios adicionales.\\

%Para fija ideas, cuando el host H1 en la sub red A envía un paquete con destino al host H3 en la subred B, primero envía el paquete al gateway de la subred A (r1) el cual entiende que el paquete debe ser reenviado al router de borde de la red del prototipo al cual esta conectada la subred, en este caso Galois. No obstante en este paso r1 no conoce la dirección de capa de enlace (direcci\'on MAC) que debe colocarse al paquete para ser reenviado a Galois; por ello utilizando el protocolo ARP (Address Resolution Protocol) inicia una consulta ARP con la direcci\'on del siguiente paso, el router r2  
 %(192.168.2.113).

%Para que esta consulta ARP pueda atravesar la red del laboratorio, así como su respuesta y para todas las combinaciones de consultas ARP en el escenario planteado, se instancia los siguientes servicios 
 %(ver tabla \ref{table:TablaFlujos2}). 

%\begin{table}[h]
%\begin{tabular}{| l | l | l | p{4cm} | p{4cm} |}
%\hline
% 
%S7 & Galois - eth1 & Oz - eth1 & arp\_tpa=192.168.2.112 eth\_type=0x0806 & Consultas ARP Subred A a Subred C \\ \hline
%
%S8 & Oz - eth1 & Galois - eth1 & arp\_tpa=192.168.2.111 eth\_type=0x0806 & Consultas ARP Subred C a Subred A \\ \hline
%
%S9 & Galois - eth1 & Poisson - eth1 & arp\_tpa=192.168.2.113 eth\_type=0x0806 & Consultas ARP Subred A a Subred B \\ \hline
%
%S10 & Poisson - eth1 & Galois - eth1 & arp\_tpa=192.168.2.111 eth\_type=0x0806 & Consultas ARP Subred B a Subred A \\ \hline
%
%S11 & Poisson - eth1 & Oz - eth1 & arp\_tpa=192.168.2.112 eth\_type=0x0806 & Consultas ARP Subred B a Subred C \\ \hline
%
%S12 & Oz - eth1 & Poisson - eth1 & arp\_tpa=192.168.2.113 eth\_type=0x0806 & Consultas ARP Subred C a Subred B \\ \hline
%
%\end{tabular}
%\vspace{0.3cm}
%\caption[CU1 - Escenario 1, servicios adicionales]{CU1 - Escenario 1, servicios adicionales}
%\label{table:TablaFlujos2}
%\end{table}

%Ahora si, se tiene definido el conjunto de servicios que implementa la red privada de capa 3 multipunto en dicho escenario, utilizando el prototipo. 

%A continuaci\'on se detallan las pruebas realizadas para cada uno de los aspectos mencionados anteriormente.

\subsubsection{Verificaci\'on del Algoritmo de ruteo}
En esta secci\'on se eval\'ua el correcto funcionamiento del algoritmo de ruteo. Para ello se comparan los caminos computados por el algoritmo para cada servicio, con los respectivos mejores caminos te\'oricos (previamente calculados de forma manual). 

Para cada camino se verifican dos cosas: (1) que el camino calculado se corresponde con el camino te\'orico y (2) que el camino es correctamente instalado en forma de reglas de reenvío (en base a conmutaci\'on de etiquetas) en las respectivas tablas de flujos OpenFlow de cada nodo en el camino.\\

Como se ha mencionado, los caminos te\'oricos son calculados manualmente observando los costos de la topolog\'ia (figura \ref{fig:LaboratorioDePruebasCostos}). Los resultados de este procedimiento se muestran en la figura \ref{fig:CUP1Caminos}, identificado cada camino mediante el código de colores de la tabla de servicios.\\

\begin{figure}[ht!] 
\centering    
\includegraphics[width=1.0\textwidth]{CU1P1Caminos}
\caption[Escenario 1 - Caminos para servicios]{Escenario 1 - Caminos para servicios}
\label{fig:CUP1Caminos}
\end{figure}

Para obtener los caminos calculados por el algoritmo de ruteo se analizan las tablas de flujos de Open vSwitch en cada uno de los nodos de la red prototipo utilizando el comando \textbf{dump-flows} de esta herramienta; de esta forma a partir de la informaci\'on en las mismas se construye cada uno de los caminos. Cabe destacar que tambi\'en puede obtenerse la informaci\'on de las tablas de flujos mediante la interfaz gráfica de RAUFlow.\\

Aplicando este procedimiento para cada uno de los servicios en la tabla \ref{table:TablaFlujos} se comprueba la correspondencia entre los caminos computados por el algoritmo de ruteo y los caminos te\'oricos, a la ves que se comprueba que son correctamente instalados como flujos en las tablas de cada nodo en el prototipo. En el apéndice \ref{appendix6.1} se incluye a modo de ejemplo el análisis realizado para los LSPs asociados a los servicios S3 y S4.\\ 
 
\subsubsection{Clasificaci\'on de tr\'afico}
Para cada servicio, se implementa clasificaci\'on de tr\'afico en el prototipo solo en el nodo ingreso, implementándose para el escenario definido en base a la numeraci\'on IP origen y destino de un paquete. Luego en cada nodo intermedio los paquetes son procesados acorde a las reglas de reenvío basadas en la conmutación de etiquetas MPLS.

Para verificar que realmente se implementa clasificaci\'on de tr\'afico se observa el comportamiento de cada flujo OpenFlow involucrado en el procesamiento del tr\'afico asociado a un servicio (flujos que clasifican tr\'afico en el nodo de ingreso y flujos que construyen un LSP). Para ello se genera tr\'afico para los servicios definidos (ver tabla \ref{table:TablaFlujos}) y mediante la herramienta de Linux \textbf{tcpdump} se captura tr\'afico por las diferentes interfaces en cada nodo involucrado en los LSPs correspondientes. 

De esta forma se genera tr\'afico de una subred a otra para cada una de las combinaciones posibles en el escenario definido sobre la red prototipo, observando que el mismo atraviesa la red del laboratorio y es entregado correctamente a la respectiva subred destino. En el ap\'endice \ref{appendix6.2} se muestran los detalles t\'ecnicos de este procedimiento para los servicios S1 y S3.\\

En la siguiente secci\'on se discute el comportamiento del prototipo, cuando la topolog\'ia cambia por ejemplo por una falla t\'ecnica en un enlace, utilizando el escenario y los servicios definidos anteriormente.

\subsubsection{Actualizaci\'on de rutas}
Para probar el correcto funcionamiento del algoritmo de ruteo, en la actualizaci\'on de rutas ante un cambio en la topolog\'ia, se trabaja con los servicios previamente definidos en \ref{table:TablaFlujos}.\\ 

Partiendo de este escenario, se simula un desperfecto t\'ecnico en los enlaces \\ $<(Galois, nf_2), (Poisson, nf_2)>$ y  $<(Poisson, nf_2), (Poisson, nf_2)>$ (por ejemplo desconectando el cable que conecta ambos nodos), provocando de esta forma una actualizaci\'on en la topolog\'ia y la posterior ejecuci\'on de los algoritmos de ruteo y distribución de etiquetas para los nuevos LSPs.\\ 
 
Acorde a los costos de la topolog\'ia (ver figura \ref{fig:LaboratorioDePruebasCostos}), en la nueva topolog\'ia los caminos te\'oricos asociados a cada servicio quedan de la siguiente forma:

\begin{figure}[h] 
\centering    
\includegraphics[width=1.0\textwidth]{CU1P1CaminosRecalculo}
\caption[Escenario 1 - Caminos para servicios recalculados]{Escenario 1 - Caminos para servicios recalculados}
\label{fig:CUP1Caminos2}
\end{figure}
 
N\'otese que los \'unicos caminos que cambian son los asociados a los servicios S3 y S6. Cabe destacar adem\'as que en la nueva topolog\'ia existe m\'as de un camino de m\'inimo costo para el servicio S3; los caminos $<(Galois, nf0), (Oz, nf1)>$ y $<(Galois, nf0), (Oz, nf2), (Alice, nf0)>$ presentan ambos el costo 4. Por tanto se tienen dos resultados v\'alidos posibles para la salida del algoritmo de ruteo para este servicio.\\

Analizando nuevamente las tablas de flujos de cada nodo en el laboratorio, se comparan los caminos computados por el algoritmo de ruteo con los caminos te\'oricos para cada servicio. Mediante este procedimiento se comprueba la correcta actualizaci\'on de caminos LSPs tras un cambio en la topolog\'ia. En el ap\'endice \ref{appendix6.3} se muestran los detalles t\'ecnicos asociados a este procedimiento para los LSPs asociados a los servicios S3 y S6.\\ 
 
De esta forma se verifica para el laboratorio de pruebas construido, la correctitud del algoritmo de ruteo, el algoritmo de distribución de etiquetas, se prueba el correcto funcionamiento de las tablas de flujos Open vSwitch y los flujos particulares utilizados para implementar clasificación de tr\'afico, se comprueba el correcto accionar del programa ante cambios en la topolog\'ia (recalculo de LSPs), y finalmente se valida la construcción de un servicio de red privada multipunto de capa 3.

En la siguiente seccci\'on se discute la verificación de otros aspectos importantes en el funcionamiento del prototipo, utilizando como escenario de pruebas la construcci\'on de dos servicios de red privada punto a punto de capa 3, utilizando dos organizaciones diferentes.   

\subsection{Escenario 2}

Este escenario (ver figura \ref{fig:CUP2}) representa una red privada punto a punto de capa 3. Esta compuesto por dos organizaciones diferentes, cada una de ellas con dos sucursales f\'isicamente separadas. Adem\'as, ambas organizaciones utilizan el mismo espacio de direccionamiento IP para sus respectivas subredes.\\

\begin{figure}[h!] 
\centering    
\includegraphics[width=1.0\textwidth]{CU1P2Caminos}
\caption[VPN de capa 3 - Escenario 2]{VPN de capa 3 - Escenario 2}
\label{fig:CUP2}
\end{figure}

%Vale la pena mencionar que debido a las limitaciones impuestas por el hardware disponible; recordar que cada nodo en el prototipo cuenta con una \'unica interfaz f\'isica disponible para conectarse a la subred de un “cliente”, solo se pueden conectar cuatro subredes al prototipo. De esta forma, el \'unico  escenario para el cual se tienen al menos dos clientes diferentes con al menos dos oficinas físicamente separadas, es el caso m\'as simple en donde cada organización tiene dos subredes. 

Este escenario se traduce en dos servicios de VPN punto a punto. Sin embargo los aspectos de implementaci\'on que en esta secci\'on se pretenden verificar, son independientes de si el servicio de VPN es punto a punto o multipunto.

Sobre este escenario se busca validar los siguientes aspectos en relaci\'on a la implementaci\'on:

\begin{enumerate}
\item El prototipo soporta la construcci\'on de servicios de VPN de capa 3 para múltiples organizaciones (recordar que en el escenario anterior se trabaja con una \'unica organización)
\item La implementaci\'on utilizada en el prototipo para transportar tr\'afico de una organización desde un nodo de ingreso a un nodo de egreso, es independiente de la numeraci\'on de capa 3 de dicho tr\'afico. En otras palabras soporta organizaciones con numeraci\'on IP solapadas.
\end{enumerate}

Para la construcci\'on de este escenario se instancia los siguientes servicios en el sistema (ver tabla \ref{table:TablaFlujos3}). Por cada red privada se instancia dos servicios (uno para cada sentido del tr\'afico).

\begin{table}[h]
\begin{tabular}{| l | l | l | p{4cm} | p{4cm} |}
\hline
Nombre & Ingreso & Egreso & Clasificación & Descripción \\ \hline

\crule[Aquamarine]{0.3cm}{0.3cm} S1 & Galois - eth1 & Alice - eth1 & ip\_src=20.20.20.64/26 ip\_dst=20.20.20.0/26 & Tr\'afico de Subred A a Subred B \\ \hline

\crule[Red]{0.3cm}{0.3cm} S2 & Alice - eth1 & Galois - eth1 & ip\_src=20.20.20.0/26 ip\_dst=20.20.20.64/26 & Tr\'afico de Subred B a Subred A \\ \hline

\crule[ForestGreen]{0.3cm}{0.3cm} S3 & Poisson - eth1 & Oz - eth1 & ip\_src=20.20.20.64/26 ip\_dst=20.20.20.0/26 & Tr\'afico de Subred A' a Subred B' \\ \hline

\crule[LimeGreen]{0.3cm}{0.3cm} S4 & Oz - eth1 & Poisson - eth1 & ip\_src=20.20.20.0/26 ip\_dst=20.20.20.64/26 & Tr\'afico de Subred B' a Subred A' \\ \hline

\end{tabular}
\vspace{0.3cm}
\caption[CU1 - Escenario 2, servicios creados]{CU1 - Escenario 2, servicios creados}
\label{table:TablaFlujos3}
\end{table}

Para todos estos servicios adem\'as se indica como valor de ethertype 0x0800, correspondiente al tipo de tr\'afico IPv4.\\


\newpage
\section{VPN de capa 2}

A diferencia de las VPN de capa 3, las cuales se definen para un protocolo o aplicaci\'on particular  
 (por ejemplo IPv4), las redes privadas de capa 2 permiten definir servicios de forma agnóstica a los mismos, transportando tr\'afico entre dos subredes de cualquier protocolo de capa 3 o aplicación.

En cierta forma, puede pensarse en un servicio de VPN de capa 2 entre dos subredes por ejemplo, como un “cable” virtual que los conecta directamente.\\

En este trabajo, a modo de ejemplo se implementan dos servicios de VPN de capa 2, sobre un escenario minimista en el que se cuenta con una \'unica organización compuesta por dos sucursales físicamente separadas, sobre la red del laboratorio previamente definida.

De esta forma lo que se busca con este escenario es construir dos “cable” y verificar que se transporta correctamente tr\'afico desde una subred a otra, independientemente del protocolo de capa 3 por ejemplo.

\subsection{Escenario}
El escenario implementado para este caso de uso se muestra en la figura \ref{fig:CUP3}. El mismo se compone de una organización con dos sucursales físicamente separadas. Se instancia dos servicios (uno para cada sentido del tr\'afico), para los cuales a su vez se muestra en la figura los caminos calculados por el algoritmo de ruteo.

\newpage
\begin{figure}[h!] 
\centering    
\includegraphics[width=1.0\textwidth]{CU3}
\caption[VPN de capa 2 Escenario]{VPN de capa 2 Escenario}
\label{fig:CUP3}
\end{figure}

En la siguiente tabla (ver tabla \ref{table:TablaFlujos4}) se muestran los servicios instanciados.

\begin{table}[h!]
\begin{tabular}{| l | l | l | p{4cm} | p{4cm} |}
\hline
Nombre & Ingreso & Egreso & Clasificación & Descripción \\ \hline

\crule[ForestGreen]{0.3cm}{0.3cm} S1 & Galois - eth1 & Poisson - eth1 & - & Tr\'afico de capa 2 de Subred A a Subred B \\ \hline

\crule[LimeGreen]{0.3cm}{0.3cm} S2 & Poisson - eth1 & Galois - eth1 & - & Tr\'afico de capa 2 de Subred B a Subred A \\ \hline

\end{tabular}
\vspace{0.3cm}
\caption[CU2 - Escenario, servicios creados]{CU2 - Escenario, servicios creados}
\label{table:TablaFlujos4}
\end{table}

Teniendo este escenario configurado, se genera tr\'afico desde la subred A a la subred B (servicio S1), probando con diferentes protocolos de capa 3, buscando verificar si el mismo atraviesa la red del laboratorio independientemente del protocolo. \\

Para generar el tr\'afico se utiliza la herramienta PacketH\cite{PacketH}, la cual permite generar paquetes asociados a diferentes protocolos desde una interfaz gr\'afica. Con esta herramienta se generan paquetes asociados a tres protocolos diferentes: ARP, IPv4 e IPv6 con tags de VLAN. En la figura \ref{fig:PaquetsSend} se muestran los paquetes generados.\\

\begin{figure}[h!] 
\centering    
\includegraphics[width=0.75\textwidth]{Escenario3/Img1}
\caption[Paquetes generados con PacketH]{Paquetes generados con PacketH}
\label{fig:PaquetsSend}
\end{figure}

De acuerdo al camino calculado para el tr\'afico asociado al servicio S1, los paquetes ingresan a la red del laboratorio por el nodo Galois y dejan el mismo por a través del nodo Poisson. Capturando tr\'afico en las interfaces asociadas a esta camino, se observa el siguiente procesamiento de tr\'afico  
 (ver figura \ref{fig:CapturaTCP}):

\begin{figure}[h!] 
\centering    
\includegraphics[width=1.0\textwidth]{Escenario3/Img2}
\caption[Caso de Uso 2 capturas]{Caso de Uso 2 capturas}
\label{fig:CapturaTCP}
\end{figure}

La imagen se corresponde con capturas de tr\'afico realizadas para las interfaces \textbf{eth1}, \textbf{nf2} del nodo \textit{Galois} y la interfaz \textbf{eth1} del nodo \textit{Poisson}. Por otro lado la primer fila de capturas se corresponde con capturas realizadas para paquetes IPv4, la segunda fila para paquetes IPv6 y finalmente la tercera fila para paquetes ARP.\\

A continuaci\'on se muestran los paquetes recibidos en la subred B utilizando la herramienta Wireshark, en donde puede observarse que los paquetes entregados por la red del prototipo son exactamente iguales a los recibidos.

\newpage
\begin{figure}[h!] 
\centering    
\includegraphics[width=0.8\textwidth]{Escenario3/ipv4n}
\caption[Captura de paquetes IPv4 recibidos con Wireshark]{Captura de paquetes IPv4 recibidos con Wireshark}
\label{fig:CapturaTCP}
\end{figure}

\begin{figure}[h!] 
\centering    
\includegraphics[width=0.8\textwidth]{Escenario3/ipV6TagVLan48n}
\caption[Captura de paquetes IPv6 recibidos con Wireshark]{Captura de paquetes IPv6 recibidos con Wireshark}
\label{fig:CapturaTCP}
\end{figure}

\begin{figure}[h!] 
\centering    
\includegraphics[width=0.8\textwidth]{Escenario3/arpn}
\caption[Captura de paquetes ARP recibidos con Wireshark]{Captura de paquetes ARP recibidos con Wireshark}
\label{fig:CapturaTCP}
\end{figure}


De esta forma se verifica la capacidad de la implementaci\'on de VPN de capa 2 para procesar tr\'afico asociado a diferentes protocolos de capas superiores con la definici\'on de un solo servicio. De igual forma se puede verificar la capacidad para procesar paquetes de cualquier otro protocolo de capas superiores.\\ 